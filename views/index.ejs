<!DOCTYPE html>
<html>
  <head>
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<meta http-equiv="refresh" content="30">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.css">
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.js"></script>
  </head>
  <body>
  	<div id="y"  class="invisible"><%= y %></div>
  	<div id="x"  class="invisible"><%= x %></div>
  	<div id="y2"  class="invisible"><%= y2 %></div>
  	<div id="x2"  class="invisible"><%= x2 %></div>
  	<div id="data" class="invisible"><%= data %></div>
    <!-- <p>Welcome to <%= title %></p> -->
    <div id="main-border">
	    <div id="top-container">
		    <h5 id="trademark">MoonshineTM, 2017
		    	
		    </h5>
		    <a id="contact" href="#">CONTACT</a>

		    <div id="statBox">
		    	<h5>Last: <span id="time"></span></h5>
		    	<h3 id="return-wrapper">Total Returns: <span id="return"></span> %</h3>
		    </div>
		    <h1 id="name" class="logo">@MOONSHINE</h1>
		    <img src="/images/rounded-robot-design-with-spirals-arms.png">
		    <div id="robot">
			    Icon made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a>
			</div>
		    


    	</div>

    	<div id="chart"></div>
    </div>
    <script type="text/javascript">
    	y = document.getElementById("y").innerHTML
    	x = document.getElementById("x").innerHTML
    	y2 = document.getElementById("y2").innerHTML
    	console.log(y2)
    	x2 = document.getElementById("x2").innerHTML
    	y_data = ['Trade Return [%]']
    	x_data = ['x']
    	y2_data = ['Portfolio Returns [%]']
    	x2_data = ['x2']

    	sort_into_list = (str, list, type) => {
    		str.split(',').forEach((i) => {
    			if (type === 'date') {
    				list.push(new Date(i))
    			} else if ( type === 'number') {
    				list.push(Number(i))
    			}
    			
    		})
    	}

    	sort_into_list(y, y_data, 'number')
    	sort_into_list(x, x_data, 'date')
    	sort_into_list(y2, y2_data, 'number')
    	sort_into_list(x2, x2_data, 'date')

    	function add(a,b) {
    		return a+b
    	}

    	// cumulative_y = ['Total Return [%]']
    	// for (var i=0; i<y.length; i++) {
    	// 	tmp_slice = y_data.slice(1, i+2);
    	// 	// console.log(tmp_slice)
    	// 	cumulative_y.push(tmp_slice.reduce(add, 0))
    	// }

  //   	cumsum = [];
		// j = y_data.slice(1);

		// for(var a=0;a<j.length;a++) {
		//   if(a==0) cumsum[a] = j[0];
		//   else cumsum[a] = cumsum[a-1] + j[a];
		// }




    	document.getElementById("return").innerHTML = 100*Number(y2_data.slice(-1)[0])/1000
    	document.getElementById("time").innerHTML = x_data.slice(-1)[0]

    	
    	// var data 
    	// console.log(cumulative_y)

    	var dataset = [{
    		data: y_data
    	}]

    	var now = new Date()
    	var day = now.getDate()
    	var month = now.getMonth() + 1;
    	var year = now.getFullYear();
    	var today = new Date(year + "-" + month + "-" + day + " 09:30:00.00")

    	var chart = c3.generate({
    		bindto: '#chart',
    		data: {
    			x: 'x',
    			columns: [
    				x_data,
    				y_data,
    				y2_data
    				
    			],
    			type: 'line'
    		},
    		axis: {
    			x: { 
    				
    				show: true,
    				min: today,
    				type: 'timeseries',
    				tick: {
    					format: '%H:%M',
    					count: y_data.length - 1
    				}

    			},
    			y: {
    				max: 5,
    				min: -5,
    				show: true,
    				label: {
    					// position: 'outer-middle',
    					// text: 'Returns',
    					// color: 'white'
    				},
    			y2: {
    				show: true
    			}
    			}
    		},
    		color: {
    			pattern: ['#6be759', 'red']
    		}
    	});
    </script>
  </body>
</html>
